<!doctype html>
<html lang="ko" name="a@hax0r.info">
	<head>
	    <meta charset="UTF-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
	    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
	    <title>영준이</title>
	    <link rel="stylesheet" type="text/css" href="src/style-sheets/common.css">
	</head>
	<body>
		<!--[if lt IE 10]>
      		<p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    	<![endif]-->
		<div id="wrap">

		</div>
		<script src="https://fb.me/react-15.0.0.js"></script>
		<script src="https://fb.me/react-dom-15.0.0.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>

		<!-- Place this tag in your head or just before your close body tag. -->
		<script async defer src="https://buttons.github.io/buttons.js"></script>
		<script defer src="src/javascript/analyticstracking.js"></script>
	    <script type="text/babel">
		/**
		 * 앱 설정 정보
		 * @type {Object}
		 */
		var appConfig = {
			'path' : {
				'video' : 'src/videos/',
				'image' : 'src/images',
				'css' : 'src/style-sheet/',
				'js' : 'src/javascript/'
			},
			'dummy' : {
				'preVideoIndex' : null
			}
		};


		/**
		 * 쿠키 생성
		 * @method createCookie
		 * @param  {[type]}     name  생성 쿠기 명
		 * @param  {[type]}     value 값
		 * @param  {[type]}     days  유효 일
		 * @return {[void]}
		 */
		function createCookie(name,value,days)
		{
		    var expires = "";
		    if ( days ) {
		        var date = new Date();
		        date.setTime(date.getTime() + (days*24*60*60*1000));
		        expires = "; expires=" + date.toUTCString();
		    }

		    document.cookie = name + "=" + value + expires + "; path=/";
		}


		/**
		 * 쿠기 조회
		 * @method readCookie
		 * @param  {[type]}   name 생성된 쿠기 명
		 * @return {[type]}        [description]
		 */
		function readCookie(name)
		{
		    var nameEq = name + "=",
				ca = document.cookie.split(';');

			for ( var i=0;i < ca.length;i++ ) {
		        var c = ca[i];
		        while ( c.charAt(0) == ' ' ) {
					c = c.substring(1,c.length);
				}

				if ( c.indexOf(nameEq) == 0 ) {
					return c.substring(nameEq.length,c.length);
				}
		    }

		    return null;
		}


		/**
		 * 쿠기 삭제
		 * @method eraseCookie
		 * @param  {[type]}    name 생성된 쿠키 명
		 * @return {[void]}
		 */
		function eraseCookie(name)
		{
		    createCookie(name,"",-1);
		}


		/**
		 * [loadMyBlogContents description]
		 * @method loadMyBlogContents
		 * @param  {integer}           page
		 * @return {object}                [볼르고 내용]
		 */
		function loadMyBlogContents(page)
		{
			var xmlHttpClient = new XMLHttpRequest(),
				feedUrl = 'http://blog.hax0r.info/rss',
				/* Access-Control-Allow-Origin 문제, Resion 에 따라서 호스트를 변경할까도 고민 중 */
				feedUrlConvertJsonWithExtraApi = 'https://api.rss2json.com/v1/api.json?rss_url='+feedUrl;

			xmlHttpClient.open("GET", feedUrlConvertJsonWithExtraApi, true);
			xmlHttpClient.send(null);

			return new Promise(function (resolve, reject)
			{
				xmlHttpClient.onreadystatechange = function ()
				{
						resolve({
							'data' : JSON.parse(xmlHttpClient.responseText)
						});
				};
			})

		}



		/**
		 * 파싱 된 블로그 게시물을 본 페이지에 적습니다.
		 * @method writeDownToArticles
		 * @param  {object}            contentsInformation Blog rss information
		 * @return {void}
		 */
		function writeDownToArticles(contentsInformation)
		{
			if ( typeof contentsInformation.items === 'undefined' ) {
				return false;
			}

			for ( var i = 0; i < contentsInformation.items.length; i++ ) {
				console.log(contentsInformation.items[i]);
			}
		}


		class App
		{

			/**
			 * 비디오 변경
			 * @method chooseVideo
			 * @param  {Number}  재생할 비디오 항목
			 * @return {void}
			 */
			static chooseVideo(index)
			{
				var maximumIndex = 3,
					videoNames = [
						'1.mov',
						'2.mov',
						'3.mov'
					],
					idx = parseInt(readCookie('hax0rVideoIndex')) || 0;

				idx = ( idx + 1+Math.floor(Math.random() * (maximumIndex-1)) ) % maximumIndex;

				var nextIdx = idx,
					returnIndex = ( typeof index === 'undefined' ) ? nextIdx : index;

				if ( appConfig.dummy.preVideoIndex == ( maximumIndex - 1 ) ) {
					returnIndex = 0;
				}

				var nextVideoPath = appConfig.path.video + videoNames[returnIndex];
				appConfig.dummy.preVideoIndex = returnIndex;

				createCookie('hax0rVideoIndex', returnIndex, 1);

				var video = document.getElementsByClassName('play-with-me')[0];
				video.pause();

				video.pause();

				var i = -1;
				while ( i++ < video.childNodes.length ) {
					if ( typeof video.childNodes[i] !== 'undefined' ) {
						console.log(video.childNodes[i].remove([0]));
					}
				}

				var source = document.createElement('source');

				source.setAttribute('src', nextVideoPath);

				video.appendChild(source);
				video.load();
				video.play();
			}


			/**
			 * 앱 초기 bootstrap
			 * @method initApplication
			 * @return {[void]}
			 */
			static initApplication()
			{
				var layOutHeader = React.createClass({
					render: function()
					{
						return (
							<div className="header-wrapper">
								<div className="header-content">
									<div className="extra-area">
										<div className="follow-me">
											<div className="follow-item pull-left-not-sm">
												<a className="github-button" 	href="https://github.com/webhacking" aria-label="Follow @webhacking on GitHub">Follow @webhacking</a>
											</div>
											<div className="follow-item pull-left-not-sm">
												<a className="github-button" href="https://github.com/ntkme/github-buttons" data-icon="octicon-star" aria-label="Star ntkme/github-buttons on GitHub">Star</a>
											</div>
										</div>
									</div>
									<div className="video-dim">
									</div>
									<div className="video-area">
										<video className="play-with-me" loop="" muted="" preload="metadata" crossorigin="anonymous" autoPlay>
								            <source src={appConfig.path.video + '1.mov'} />
								        </video>
									</div>
								</div>
							</div>
						)
					}
				});

				var LayoutBody = React.createClass({
					render : function()
					{
						return (
							<div className="body-wrapper">
							</div>
						)
					}
				});

				ReactDOM.render(
					<layOutHeader/>,
					document.getElementById('wrap')
				);
			}
		}

		if ( 'addEventListener' in document ) {
			console.log('Welcome');
			try {
				App.initApplication(document.readyState);

				var blogContents = loadMyBlogContents();
				blogContents.then(function(contentsInformation)
				{
					writeDownToArticles(contentsInformation.data);
				})
				setInterval(function()
				{
					App.chooseVideo();
				},15000)
			}
			catch(e) {
				switch (true) {
					case (e instanceof EvalError):
						throw new Error("Eval에러" + e.message);
						console.log("Eval에러" + e.message);
						break;
					case (e instanceof RangeError):
						throw new Error("Range에러: " + e.message);
						console.log("Range에러: " + e.message);
						break;
					default:
						throw new Error("블라: " + e.message);
						console.log("블라: " + e.message);
					break;
				}
			}
			finally {
				console.log('%c 버그 찾으면 알려주세요. a@hax0r.info', 'background: #222; color: #bada55');
			}
		}
	    </script>
	</body>
</html>
